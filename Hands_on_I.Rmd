---
title: "Analysis of Heart Disease Dataset"
author: "Emma Juan Salazar (emma.juan01@estudiant.upf.edu) and Gary etc."
date: "Last update: `r format(Sys.time(), '%d %B, %Y')`"      
output:
  html_document:
    toc: true
    fig_caption: true
  html_notebook: 
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Analysis of the Heart Disease Dataset

Load the data from [here](https://raw.githubusercontent.com/jpinero/DMI_2021/main/datasets/heart_disease_dataset.csv), and the description is [here](https://raw.githubusercontent.com/jpinero/DMI_2021/main/datasets/heart_disease_description.txt). The original dataset comes from [here](https://archive.ics.uci.edu/ml/datasets/Heart+Disease) and corresponds to the [processed cleveland data](https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.cleveland.data)

## Perform an EDA on the dataset

# 1. Getting to know the dataset

First, we import the necessary libraries

```{r}
library(ggplot2)
library(DataExplorer)
library(mlbench)
library(GGally)
library(tidyverse)
library(vtable)
library(SmartEDA)
library(corrplot)
```

## The features on our dataset are the following

1.  age (Age in years)

2.  sex : (1 = male, 0 = female)

3.  cp (Chest Pain Type): [ 0: asymptomatic, 1: atypical angina, 2: non-anginal pain, 3: typical angina]

4.  trestbps (Resting Blood Pressure in mm/hg )

5.  chol (Serum Cholesterol in mg/dl)

6.  fps (Fasting Blood Sugar \> 120 mg/dl): [0 = no, 1 = yes]

7.  restecg (Resting ECG): [0: showing probable or definite left ventricular hypertrophy by Estes' criteria, 1: normal, 2: having ST-T wave abnormality]

8.  thalach (maximum heart rate achieved)

9.  exang (Exercise Induced Angina): [1 = yes, 0 = no]

10. oldpeak (ST depression induced by exercise relative to rest)

11. slope (the slope of the peak exercise ST segment): [0: downsloping; 1: flat; 2: upsloping]

12. ca [number of major vessels (0--3)

13. thal : [1 = normal, 2 = fixed defect, 3 = reversible defect]

14. target: [0 = disease, 1 = no disease]

------------------------------------------------------------------------

We import the data, and we name the columns.

We use na.strings="?" to replace all of the missing values in our dataset, indicated with the character "?", with NA.

```{r}
heart_data = read.csv("data/heart_disease_dataset.csv", sep=" ", na.strings="?")

colnames(heart_data) <- c("Age", "Sex", "ChestPain", "RBP", "Cholesterol", "FastingBloodSugar", "RestingECResults", "MaxHeartRate", "ExInducedAngina", "Oldpeak", "Slope", "NbMajorVessels", "Thalassemia", "DiagnosisHD", "PatetientID")

# We use dim() to obtain the number of rows and columns on our dataset

dim(heart_data)
```

We indicate which features are categorical variables and which features are continuous variables:

```{r}
cont_features = c("Age", "RBP", "Cholesterol", "MaxHeartRate", "Oldpeak")
cat_features = c("Sex", "ChestPain", "FastingBloodSugar", "RestingECResults", "ExInducedAngina", "Slope", "NbMajorVessels", "Thalassemia", "DiagnosisHD")
```

We can change some of the categorical features' values to clarify:

```{r}
# We replace the numbers with "male" and "female" for the Sex column
heart_data["Sex"][heart_data["Sex"] == 1] <- "male"
heart_data["Sex"][heart_data["Sex"] == 0] <- "female"
```

# 2. Data cleaning

First, we check the variable types, and obtain some initial information about the range of our values:

We use the ExpData function from the SmartEDA package: type=2 is for a summary of each individual variable, and the argument fun is where we indicate the information we want. We want the minimum and maximum to know the range of our values, and to check if they range accordingly to the features' definitions.

```{r}
ExpData(data=heart_data, type=2, fun = c("min", "max"))
```

With this information, we can check for missing values.

Our percentage of missing data is very low, so we can go ahead and replace the missing values with the median.

```{r}
heart_data$NbMajorVessels[is.na(heart_data$NbMajorVessels)] <- median(heart_data$NbMajorVessels, na.rm = TRUE)

heart_data$Thalassemia[is.na(heart_data$Thalassemia)] <- median(heart_data$Thalassemia, na.rm = TRUE)
```

## Create visualizations in order to show which variables seem to be more associated with heart disease

```{r}
heart_data
```

# 2 Difference in mortality rates in hospitalized COVID-19 patients

Using the supplementary material from the [Difference in mortality rates in hospitalized COVID-19 patients identified by cytokine profile clustering using a machine learning approach: An outcome prediction alternative](https://www.frontiersin.org/articles/10.3389/fmed.2022.987182/full), perform the following tasks

## Reproduce Figure 1 from the publication

```{r}

```

## Reproduce Figure 2 from the publication

but instead of representing the clusters in the annotation, represent the groups (G1 to G4)

```{r}

```

## Improve figure 2 of the publication

Add a second annotation with information of deathm and a third one with information of gender

```{r}

```

# session info {.unnumbered}

```{r, results='asis',  echo=FALSE, message=FALSE }
sessionInfo()
```
